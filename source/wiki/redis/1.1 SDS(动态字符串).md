---
title: 1.1 SDS(动态字符串)
date: 2022-09-24 21:14:26 
updated: 2022-10-06 19:53:18
tags: [] 
top: false
mathjax: true
categories: []
author: booiris
layout: wiki 
wiki: redis
order:   3   # add order, base on problem number.
---

## SDS介绍

Redis自己构建了一种名为简单动态字符串(simple dynamic string, SDS) 的抽象类型，并将其作为Redis的默认字符串表示。

## SDS定义

在 Redis7.0 中 定义的代码位于 `src/sds.h` 中，定义如下。

```c
/* Note: sdshdr5 is never used, we just access the flags byte directly.
 * However is here to document the layout of type 5 SDS strings. */
struct __attribute__ ((__packed__)) sdshdr5 {
    unsigned char flags; /* 3 lsb of type, and 5 msb of string length */
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr8 {
    uint8_t len; /* used */
    uint8_t alloc; /* excluding the header and null terminator */
    unsigned char flags; /* 3 lsb of type, 5 unused bits */
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr16 {
    uint16_t len; /* used */
    uint16_t alloc; /* excluding the header and null terminator */
    unsigned char flags; /* 3 lsb of type, 5 unused bits */
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr32 {
    uint32_t len; /* used */
    uint32_t alloc; /* excluding the header and null terminator */
    unsigned char flags; /* 3 lsb of type, 5 unused bits */
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr64 {
    uint64_t len; /* used */
    uint64_t alloc; /* excluding the header and null terminator */
    unsigned char flags; /* 3 lsb of type, 5 unused bits */
    char buf[];
};
```

根据字符串长度不同，用来存放它的sds类型也不同。

其中 `len` 表示使用的字符串长度，`alloc` 表示分配的总空间的长度，`flag` 表示当前结构体类型，因为只有五种类型，所以只使用低三位。

结构前加上了 ` __attribute__ ((__packed__)) ` 取消编译器的内存对齐。

<img src="https://cdn.jsdelivr.net/gh/booiris-cdn/img//20221006194934.png" width = 100% >



## 参考

1. [c - Redis 源码解读——sds_个人文章 - SegmentFault 思否](https://segmentfault.com/a/1190000041832335)
2. [redis源码解读(一):基础数据结构之SDS_czrzchao的博客-CSDN博客](https://blog.csdn.net/czrzchao/article/details/78990345)
